<div class="row">
  <p-tabMenu [model]="items" [activeItem]="activeItem"></p-tabMenu>
</div>
<br>
<div class="row" >
  <button pButton icon="pi pi-plus" label="ინვენტარის მიღება" class="ui-button-success" (click)="inventorDialog()"></button> &nbsp; &nbsp;
  <button pButton icon="pi pi-pencil" label="რედაქტირება" class="ui-button-raised" (click)="inventorDialog()"></button>

  <button (click)="inventoryToBuildingDialog()" pButton type="button" label="ინვენტარის გაცემა" class="ui-button-raised" style="position: absolute; right: 400px"></button> &nbsp;&nbsp;
  <button (click)="showDialog()" pButton type="button" label="ინვენტარის მოძრაობა სექციებს შორის" class="ui-button-raised"  style="position: absolute; right: 100px"></button>&nbsp;&nbsp;
  <span style="position: absolute;right: 37px;margin-top: 3px;color: #007ad9;">
    <fa-icon [icon]="faCartPlus"  (click)="cartDialog()" size="2x"  ></fa-icon>
    {{this.cartItems.length}}
  </span>
</div>
<br>
<div class="row">
  <ag-grid-angular
    #agGrid
    style="width: 100%; height: 800px;"
    id="myGrid"
    class="ag-theme-balham"
    [columnDefs]="columnDefs"
    [floatingFilter]="true"
    [debug]="true"
    [defaultColDef]="defaultColDef"
    [rowSelection]="rowSelection"
    [rowDeselection]="true"
    [rowModelType]="rowModelType"
    [paginationPageSize]="paginationPageSize"
    [cacheOverflowSize]="cacheOverflowSize"
    [maxConcurrentDatasourceRequests]="maxConcurrentDatasourceRequests"
    [infiniteInitialRowCount]="infiniteInitialRowCount"
    [maxBlocksInCache]="maxBlocksInCache"
    [getRowNodeId]="getRowNodeId"
    [components]="components"
    [rowData]="rowData"
    [pivotPanelShow]="true"
    (gridReady)="onGridReady($event)"
    (cellDoubleClicked)="cart($event)"
  ></ag-grid-angular>
</div>



<p-dialog header="ინვენტარის მოძრაობა სექციებს შორის" [(visible)]="display" [modal]="true" [responsive]="true" [style]="{width: '700px', minWidth: '200px'}" [minY]="500"
          [maximizable]="true" [draggable]="true" [baseZIndex]="10000">
  <div style="width: 100%;height: 500px;" *ngIf="transferToSectionInvoiceGenerator">
    <app-generator [transferToSection]="transferToSection" ></app-generator>
  </div>
  <div style="width: 100%;height: 500px;" *ngIf="!transferToSectionInvoiceGenerator">
    <div class="ui-g ui-fluid">
      <div class="ui-g-12 ui-md-4">
       <p>თარიღი</p>
        <p-calendar [(ngModel)]="transferToSection.Datetime" [showIcon]="true"></p-calendar>
      </div>
      <div class="ui-g-12 ui-md-4">
        <p>სექცია</p>
        <p-dropdown [options]="stockList" optionLabel="name" placeholder="აირჩიეთ სექცია" [(ngModel)]="transferToSection.fromDetails" (ngModelChange)="getTransferProperty()"></p-dropdown>
      </div>
      <div class="ui-g-12 ui-md-4">
        <p>ფროფერთი</p>
        <p-dropdown [options]="propertyData" optionLabel="fullname" placeholder="ფროფერთი" [(ngModel)]="transferToSection.toWhomStockDetails" ></p-dropdown>
      </div>
      <div class="ui-g-12 ui-md-12">
         <p>ტრანსპორტ. პასხ. პირი:</p>
        <p-autoComplete [suggestions]="staffList" (completeMethod)="filterStaff($event)" [size]="30" [(ngModel)]="transferToSection.carrierPersonDetails"
                        [minLength]="1" placeholder=""  field="name" [dropdown]="true">

        </p-autoComplete>
      </div>
      <div class="ui-g-12 ui-md-12">
        <p>კომენტარი</p>
        <textarea pInputTextarea placeholder="შენიშვნა" [(ngModel)]="transferToSection.note"></textarea>
      </div>
      <app-cart [data]="cartItemsData" (removeCartItem)="removeCartItem()" ></app-cart>
    </div>
  </div>
  <p-footer>
    <button type="button" pButton icon="pi pi-check"  *ngIf="!transferToSectionInvoiceGenerator"(click)="generaTeTransferToSection()" label="ზედდებულის გენერაცია"></button>
    <button type="button" pButton icon="pi pi-check"  *ngIf="transferToSectionInvoiceGenerator" (click)="activeTransferToSection()" label="ზედდებულის გააქტიურება"></button>
    <button type="button" pButton icon="pi pi-close" (click)="display=false" label="დახურვა" class="ui-button-secondary"></button>
  </p-footer>
</p-dialog>

<p-dialog header=" "
[(visible)]="cartDialogShow" [modal]="true" [responsive]="true" [style]="{width: '700px', minWidth: '200px'}" [minY]="500" [maximizable]="true" [draggable]="true" [baseZIndex]="10000">
  <div style="width: 100%;height: 500px;">
    <app-cart [data]="cartItemsData" (removeCartItem)="removeCartItem()" ></app-cart>
  </div>
</p-dialog>

<p-dialog header="ინვენტარის გაცემა" [(visible)]="inventoryToBuildingDialogShow" [modal]="true" [responsive]="true" [style]="{width: '700px', minWidth: '200px'}" [minY]="500"
          [maximizable]="true" [draggable]="true" [baseZIndex]="10000">

  <div style="width: 100%;height: 500px;" *ngIf="inventorTransfer.generator">
    <app-generator [transferToSection]="inventorTransfer" ></app-generator>
  </div>
  <div style="width: 100%;height: 500px;" *ngIf="!inventorTransfer.generator">
      <p-tabView (onChange)="onTabChange($event)" >
        <p-tabPanel header="შენობა" [selected]="true" >
          <div class="ui-g ui-fluid" >
            <div class="ui-g-12 ui-md-4">
              <p>თარიღი</p>
              <p-calendar [(ngModel)]="inventorTransfer.date" [showIcon]="true" [ngClass]="{ 'red':if_error(formErrors,'date')?'1px solid red': '' }"></p-calendar>
            </div>

            <div class="ui-g-12 ui-md-12">
              <p>ფროფერთი</p>
              <p-autoComplete [suggestions]="staffList" (completeMethod)="filterStaff($event)" [size]="30" [(ngModel)]="inventorTransfer.selectedProperty"
                              [minLength]="1" placeholder=""  field="name" [dropdown]="true" [ngClass]="{ 'red':if_error(formErrors,'selectedProperty')?'1px solid red': '' }">

              </p-autoComplete>
            </div>

            <div class="ui-g-12 ui-md-12">
              <p>მომთხოვნი პიროვნება</p>
              <p-autoComplete [suggestions]="staffList" (completeMethod)="filterStaff($event)" [size]="30" [(ngModel)]="inventorTransfer.selectedPerson"
                              [minLength]="1" placeholder=""  field="name" [dropdown]="true"  [ngClass]="{ 'red':if_error(formErrors,'selectedPerson')?'1px solid red': '' }">

              </p-autoComplete>
            </div>

            <div class="ui-g-12 ui-md-12">
              <p>ტრანსპორტ. პასხ. პირი:</p>
              <p-autoComplete [suggestions]="staffList" (completeMethod)="filterStaff($event)" [size]="30" [(ngModel)]="inventorTransfer.selectedCarrier"
                              [minLength]="1" placeholder=""  field="name" [dropdown]="true" [ngClass]="{ 'red':if_error(formErrors,'selectedCarrier')?'1px solid red': '' }" >

              </p-autoComplete>
            </div>

            <div class="ui-g-12 ui-md-12">
              <p>კომენტარი</p>
              <textarea pInputTextarea placeholder="შენიშვნა" [(ngModel)]="inventorTransfer.note" [ngClass]="{ 'red':if_error(formErrors,'note')?'1px solid red': '' }"></textarea>
            </div>
           <app-cart [data]="cartItemsData"></app-cart>
          </div>
        </p-tabPanel>
        <p-tabPanel header="პიროვნება" >
          <div class="ui-g ui-fluid" >
            <div class="ui-g-12 ui-md-4">
              <p>თარიღი</p>
              <p-calendar [(ngModel)]="inventorTransfer.date" [showIcon]="true" [ngClass]="{ 'red':if_error(formErrors,'date')?'1px solid red': '' }"></p-calendar>
            </div>

            <div class="ui-g-12 ui-md-12">
              <p>პიროვნება</p>
                <p-autoComplete [suggestions]="staffList" (completeMethod)="filterStaff($event)" [size]="30" [(ngModel)]="inventorTransfer.selectedProperty"
                               (onSelect)="selectPerson($event)" [minLength]="1" placeholder=""  field="name" [dropdown]="true" [ngClass]="{ 'red':if_error(formErrors,'selectedProperty')?'1px solid red': '' }">
                </p-autoComplete>
            </div>
            <div class="ui-g-12 ui-md-11">
              <p>სექცია</p>
              <p-dropdown [disabled]="!inventorTransfer.toWhomSection" [options]="stockList" optionLabel="name" placeholder="აირჩიეთ სექცია" [(ngModel)]="inventorTransfer.selectedSection" [ngClass]="{ 'red':if_error(formErrors,'selectedSection')?'1px solid red': '' }" ></p-dropdown>
            </div>
            <div class="ui-g-12 ui-md-12">
              <p>მომთხოვნი პიროვნება</p>
              <p-autoComplete [suggestions]="staffList" (completeMethod)="filterStaff($event)" [size]="30" [(ngModel)]="inventorTransfer.selectedPerson"
                              [minLength]="1" placeholder=""  field="name" [dropdown]="true" [ngClass]="{ 'red':if_error(formErrors,'selectedPerson')?'1px solid red': '' }">

              </p-autoComplete>
            </div>

            <div class="ui-g-12 ui-md-12">
              <p>ტრანსპორტ. პასხ. პირი:</p>
              <p-autoComplete [suggestions]="staffList" (completeMethod)="filterStaff($event)" [size]="30" [(ngModel)]="inventorTransfer.selectedCarrier"
                              [minLength]="1" placeholder=""  field="name" [dropdown]="true" [ngClass]="{ 'red':if_error(formErrors,'selectedCarrier')?'1px solid red': '' }">

              </p-autoComplete>
            </div>

            <div class="ui-g-12 ui-md-12">
              <p>კომენტარი</p>
              <textarea pInputTextarea placeholder="შენიშვნა" [(ngModel)]="inventorTransfer.note"></textarea>
            </div>
            <app-cart [data]="cartItemsData"></app-cart>
          </div>
        </p-tabPanel>
      </p-tabView>

  </div>
  <p-footer>
    <button type="button" pButton icon="pi pi-check"  *ngIf="!inventorTransfer.generator" (click)="generaTeInventorTransfer()" label="ზედდებულის გენერაცია"></button>
    <button type="button" pButton icon="pi pi-check"  *ngIf="inventorTransfer.generator"  (click)="activeInventorTransfer()" label="ზედდებულის გააქტიურება"></button>
    <button type="button" pButton icon="pi pi-close" (click)="inventoryToBuildingDialogShow=false" label="დახურვა" class="ui-button-secondary"></button>
  </p-footer>
</p-dialog>

<p-dialog header="ჩანაწერის დამატება" [(visible)]="newRecordDialogShow" [modal]="true" [responsive]="true" [style]="{width: '350px', minWidth: '200px'}" [minY]="70"
          [maximizable]="true" [baseZIndex]="10000">
  <input id="input" type="text" size="30" pInputText [(ngModel)]="newItem.value">
  <p-footer>
    <button type="button" pButton icon="pi pi-check" (click)="saveNewRecord()" label="Yes"></button>
    <button type="button" pButton icon="pi pi-close" (click)="newRecordDialogShow=false" label="No" class="ui-button-secondary"></button>
  </p-footer>
</p-dialog>

<p-dialog header="საქონლის ჯგუფი" [(visible)]="itemGroupDialogShow" [modal]="true" [responsive]="true" [style]="{width: '500px', minWidth: '200px'}" [minY]="70"
          [maximizable]="true" [baseZIndex]="10000">
  <p-tree [value]="ItemGroup" selectionMode="single"
          (onNodeSelect)="nodeSelect($event)" (onNodeUnselect)="nodeUnselect($event)"></p-tree>
  <div style="margin-top:8px">Selected Node: {{newInventor.itemGroupName ? newInventor.itemGroupName : 'none'}}</div>

  <p-footer>
    <button type="button" pButton icon="pi pi-check" (click)="itemGroupDialogShow=false" label="Yes"></button>
    <button type="button" pButton icon="pi pi-close" (click)="itemGroupDialogShow=false" label="No" class="ui-button-secondary"></button>
  </p-footer>
</p-dialog>

<p-dialog header="ინვენტარის მიღება" [(visible)]="inventorDialogShow" [modal]="true" [responsive]="true" [style]="{width: '1200px', minWidth: '200px'}" [minY]="500"
          [maximizable]="true" [draggable]="true" [baseZIndex]="10000">
  <div style="width: 100%;height: 500px;" *ngIf="!frustrate">
    <div class="ui-g ui-fluid">
      <div class="ui-g-12 ui-md-2" >
        <p>მიღების თარიღი</p>
        <p-calendar [(ngModel)]="newInventor.date" [showIcon]="true" ></p-calendar>
      </div>
      <div class="ui-g-12 ui-md-4">
        <div class="ui-inputgroup">
          <table style="width: 100%; border-collapse: collapse" >
            <tr >
              <td colspan="2" style="padding: 0px;line-height: 20px;margin: 0px;" *ngIf="!newInventor.consumption">შტრიხკოდი</td>
              <td style="padding: 0px; line-height: 20px;margin: 0px;" >რაოდ</td>
              <td *ngIf="newInventor.consumption" style="padding: 0px;line-height: 20px;margin: 0px;" > შ.რაოდ</td>
            </tr>
            <tr >
              <td *ngIf="!newInventor.consumption" width="35px">
                <p-dropdown [ngClass]="{ 'red':errors.barcode?'1px solid red': '' }"  [autoWidth]="true" [options]="barcodes"  placeholder="RS" optionLabel="name" [(ngModel)]="newInventor.selectedBarcode"  [showClear]="true" (ngModelChange)="getLastCode()" ></p-dropdown>
              </td>
              <td *ngIf="!newInventor.consumption">
                <input type="text" pInputText placeholder="შტრიხკოდი" style="width: 100%; height: 33px;" [(ngModel)]="newInventor.barCode"  >
              </td>
              <td>
                <input type="text" pInputText placeholder="რაოდ" style="width: 100%; height: 33px;"  [(ngModel)]="newInventor.amount">
              </td>
              <td *ngIf="newInventor.consumption">
                <input type="text" pInputText placeholder="შ.რაოდ" style="width: 100%; height: 33px;"  [(ngModel)]="newInventor.packageAmount" >
              </td>
            </tr>
          </table>
        </div>
      </div>
      <div class="ui-g-12 ui-md-3" >
        <p>განზომილების ერთეული</p>
        <div class="ui-inputgroup" >
            <p-dropdown  [ngClass]="{ 'red':errors.measureUnit?'1px solid red': '' }" [autoWidth]="true" class="measureUnits" [options]="measureUnits"  placeholder="ერთეული" optionLabel="name" [(ngModel)]="newInventor.selectedMeasureUnitName"  [showClear]="true" ></p-dropdown>
        </div>
      </div>
      <div class="ui-g-12 ui-md-3" >
        <p>საქონლის ჯგუფი</p>
        <div class="ui-inputgroup">
          <input type="text" pInputText placeholder="საქონლის ჯგუფი" disabled [(ngModel)]="newInventor.itemGroupName" style="width: 100%" [ngClass]="{ 'red':errors.group?'1px solid red': '' }" >
          <button (click)="itemGroupDialog()" pButton type="button" label="..."></button>
        </div>
      </div>
    </div>

    <div class="ui-g">
      <div class="ui-g-8 ui-g-nopad">
        <div class="ui-g-4" >
          <p>დასახელება</p>

            <p-autoComplete [ngClass]="{ 'red':errors.name?'1px solid red': '' }"  [suggestions]="filteredInventors" (completeMethod)="filterInventorsByName($event)" field="name" [size]="30"
                             placeholder="დასახელება" [minLength]="1" [(ngModel)]="newInventor.fullname" [forceSelection]="true" (onSelect)="selectedName()"></p-autoComplete>

        </div>
        <div class="ui-g-4">
          <p>ქარხნული ნომერი</p>
          <input type="text" pInputText style="width:100%;height: 35px;" [(ngModel)]="newInventor.factoryNumber"/>
        </div>
        <div class="ui-g-4">
          <p>ინვენტარის ტიპი</p>
          <p-dropdown [options]="itemTypes"  placeholder="ტიპი" optionLabel="name" [showClear]="true" [(ngModel)]="newInventor.selectedItemType" ></p-dropdown>
        </div>
        <div class="ui-g-4">
          <p>მარკა</p>
          <table>
            <tr>
              <td>
                <p-autoComplete [suggestions]="ItemData" (completeMethod)="filterItemSingle($event,'marker')" field="name" type="marker" [size]="30"
                                placeholder="მარკა" [minLength]="1" [(ngModel)]="newInventor.selectedMaker"></p-autoComplete>
              </td>
              <td>
                <p-button icon="pi pi-plus" (click)="newRecordDialog('marker')"></p-button>
              </td>
            </tr>
          </table>
        </div>
        <div class="ui-g-4">
          <p>მიმწოდებელი</p>
          <table>
            <tr>
              <td>
                <p-autoComplete [suggestions]="ItemData" (completeMethod)="filterItemSingle($event, 'supplier')" field="name" [size]="30"
                                placeholder="მიმწოდებელი" [minLength]="1" [(ngModel)]="newInventor.selectedSupplier"></p-autoComplete>
              </td>
              <td>
                <p-button icon="pi pi-plus" (click)="newRecordDialog('supplier')"></p-button>
              </td>
            </tr>
          </table>


        </div>
        <div class="ui-g-4">
          <p>ინვენტარის სტატუსი</p>
          <p-dropdown [options]="itemStatus"  placeholder="სტატუსი" optionLabel="name" [showClear]="true" [(ngModel)]="newInventor.selectedItemStatus"></p-dropdown>

        </div>
        <div class="ui-g-12">
          <div class="ui-g-4">
            <p>მოდელი</p>
            <table>
              <tr>
                <td>
                  <p-autoComplete [suggestions]="ItemData" (completeMethod)="filterItemSingle($event, 'model')" field="name" [size]="30"
                                  placeholder="მოდელი" [minLength]="1" [(ngModel)]="newInventor.selectedModel"></p-autoComplete>
                </td>
                <td>
                  <p-button icon="pi pi-plus" (click)="newRecordDialog('model')"></p-button>
                </td>
              </tr>
            </table>
          </div>
          <div class="ui-g-4">
            <p>სასაქონლო ზედნადები</p>
            <input type="text" pInputText style="width:100%;height: 35px;"  [(ngModel)]="newInventor.invoice"  />
          </div>
          <div class="ui-g-4">
            <p>ინსპექტირების დასკვნის ნომერი</p>
            <input type="text" pInputText style="width:100%;height: 35px;" [(ngModel)]="newInventor.inspectionNumber" />
          </div>
        </div>
        <div class="ui-g-12">
          <div class="ui-g-4" >
            <p>ფასი</p>
            <p-spinner size="30" step="0.25"   [(ngModel)]="newInventor.price" [ngClass]="{ 'red':errors.price?'1px solid red': '' }" ></p-spinner>

          </div>
          <div class="ui-g-4">
            <p>საბუღალტრო ზედდებული</p>
            <input type="text" pInputText style="width:100%;height: 35px;"   [(ngModel)]="newInventor.invoiceAddon" >
          </div>
        </div>
      </div>
      <div class="ui-g-4">
        <p>შენიშვნა</p>
        <textarea rows="10" cols="30" pInputTextarea style="width: 100%" [(ngModel)]="newInventor.note" ></textarea>
      </div>
    </div>
  </div >
  <div style="width: 100%;height: 500px;" *ngIf="frustrate">
      <table style="border-collapse: collapse; width: 100%" class="table">
          <thead>
            <tr>
              <th>თარიღი</th>
              <th>დასახელება</th>
              <th>მარკა</th>
              <th>მოდელი</th>
              <th>ფასი</th>
              <th>რაოდენობა</th>
              <th>განზ.ერთ</th>
              <th>შტრიხკოდი</th>
              <th>ქარხ#</th>
              <th>ჯგუფი</th>
              <th>ტიპი</th>
              <th>სტატუსი</th>
              <th>მიმწოდებელი</th>
              <th>ზედნადები</th>
              <th>ზედდებული</th>
              <th>ინსპ#</th>
            </tr>
          </thead>
          <tbody>
          <tr *ngFor="let c of lastBarCodes">
            <td>{{newInventor.entryDate}}</td>
            <td>{{newInventor.name}}</td>
            <td>{{newInventor.selectedMaker.name}}</td>
            <td>{{newInventor.selectedModel.name}}</td>
            <td>{{newInventor.price}}</td>
            <td>{{newInventor.amount}}</td>
            <td>{{newInventor.measureUnitName}}</td>
            <td>{{c.value}}<input type="text" [(ngModel)]="c.barCodeVisualValue" class="input"></td>
            <td><input type="text" [(ngModel)]="c.factoryNumber" class="input"></td>
            <td>{{newInventor.itemGroupName}}</td>
            <td>{{newInventor.selectedItemType.name}}</td>
            <td>{{newInventor.selectedItemStatus.name}}</td>
            <td>{{newInventor.selectedSupplier.name}}</td>
            <td>{{newInventor.invoice}}</td>
            <td>{{newInventor.invoiceAddon}}</td>
            <td>{{newInventor.inspectionNumber}}</td>
          </tr>
          </tbody>
      </table>

  </div>
  <p-footer>
    <span class="lastCode">ბოლო შტრიხკოდი: {{newInventor.fullBarCode}}</span>
    <button type="button" pButton icon="pi pi-save" *ngIf="frustrate" (click)="saveNewInventor()" label="შენახვა" ></button>
    <button type="button" pButton icon="pi pi-save" *ngIf="!frustrate" (click)="frustrateInventor()" label="ჩაშლა" ></button>
    <button type="button" pButton icon="pi pi-close" *ngIf="frustrate" (click)="frustrate=false" label="დაბრუნება" class="ui-button-secondary"></button>
    <button type="button" pButton icon="pi pi-close" (click)="cartDialogShow=false" label="დახურვა" class="ui-button-secondary"></button>
  </p-footer>
</p-dialog>
