<p-confirmDialog [style]="{width: '50vw'}"></p-confirmDialog>

<div class="actionButton">
  <div class="buttonBox">
    <p-tabMenu [model]="items" [activeItem]="items[0]" ></p-tabMenu>
  </div>
  <div class="buttonBox">
    <button (click)="showDialog()" *ngIf="!distributed" pButton type="button" label="ინვ. შებრუნება" class="ui-button-raised"></button> &nbsp;&nbsp;
    <button (click)="inventoryToBuildingDialog()" *ngIf="distributed" pButton type="button" label="ინვ. მოძრაობა შენობებს შორის" class="ui-button-raised"></button>&nbsp;&nbsp;
    <button (click)="personDialog()" *ngIf="distributed" pButton type="button" label="განპიროვნება" class="ui-button-danger"></button>&nbsp;&nbsp;
    <span class="cart">
      <fa-icon [icon]="faCartPlus"  (click)="cartDialog()" size="2x"  ></fa-icon>
      {{this.cartItems.length}}
    </span>
  </div>
</div>




<div class="row" *ngIf="inOut ==='out'">
  <ag-grid-angular
    #agGrid
    style="width: 100%;height: calc(100vh - 135px);"
    id="myGrid"
    class="ag-theme-balham"
    [columnDefs]="columnDefs"
    [floatingFilter]="true"
    [debug]="true"
    [rowClassRules]="getRowStyle"
    [defaultColDef]="defaultColDef"
    [rowSelection]="rowSelection"
    [rowDeselection]="true"
    [rowModelType]="rowModelType"
    [paginationPageSize]="paginationPageSize"
    [cacheOverflowSize]="cacheOverflowSize"
    [maxConcurrentDatasourceRequests]="maxConcurrentDatasourceRequests"
    [infiniteInitialRowCount]="infiniteInitialRowCount"
    [maxBlocksInCache]="maxBlocksInCache"
    [getRowNodeId]="getRowNodeId"
    [components]="components"
    [rowData]="rowData"
    [pivotPanelShow]="true"
    (gridReady)="onGridReady($event)"
    (cellClicked)="cart($event)"
    [gridOptions]="gridOptions"
    [getContextMenuItems]="getContextMenuItems"
    [frameworkComponents]="frameworkComponents"

  ></ag-grid-angular>
</div>
<div class="row" *ngIf="inOut ==='in'">
  <ag-grid-angular
    #agGrid
    style="width: 100%;height: calc(100vh - 135px);"
    id="myGrid"
    class="ag-theme-balham"
    [columnDefs]="columnDefs1"
    [floatingFilter]="true"
    [debug]="true"
    [rowClassRules]="getRowStyle"
    [defaultColDef]="defaultColDef"
    [rowSelection]="rowSelection"
    [rowDeselection]="true"
    [rowModelType]="rowModelType"
    [paginationPageSize]="paginationPageSize"
    [cacheOverflowSize]="cacheOverflowSize"
    [maxConcurrentDatasourceRequests]="maxConcurrentDatasourceRequests"
    [infiniteInitialRowCount]="infiniteInitialRowCount"
    [maxBlocksInCache]="maxBlocksInCache"
    [getRowNodeId]="getRowNodeId"
    [components]="components"
    [rowData]="rowData"
    [pivotPanelShow]="true"
    (gridReady)="onGridReady($event)"
    (cellClicked)="cart($event)"
    [gridOptions]="gridOptions"
    [getContextMenuItems]="getContextMenuItems"
    [frameworkComponents]="frameworkComponents"

  ></ag-grid-angular>
</div>
<div class="row" *ngIf="inOut ==='v2'">
  <ag-grid-angular
    #agGrid
    style="width: 100%;height: calc(100vh - 135px);"
    id="myGrid"
    class="ag-theme-balham"
    [columnDefs]="columnDefs1"
    [floatingFilter]="true"
    [debug]="true"
    [rowClassRules]="getRowStyle"
    [defaultColDef]="defaultColDef"
    [rowSelection]="rowSelection"
    [rowDeselection]="true"
    [rowModelType]="rowModelType"
    [paginationPageSize]="paginationPageSize"
    [cacheOverflowSize]="cacheOverflowSize"
    [maxConcurrentDatasourceRequests]="maxConcurrentDatasourceRequests"
    [infiniteInitialRowCount]="infiniteInitialRowCount"
    [maxBlocksInCache]="maxBlocksInCache"
    [getRowNodeId]="getRowNodeId"
    [components]="components"
    [rowData]="rowData"
    [pivotPanelShow]="true"
    (gridReady)="onGridReady($event)"
    (cellClicked)="cart($event)"
    [gridOptions]="gridOptions"
    [getContextMenuItems]="getContextMenuItems"
  ></ag-grid-angular>
</div>
<p-dialog header="ინვენტარის საწყობში დაბრუნება" *ngIf="display" [(visible)]="display" [modal]="true" [responsive]="true" [style]="{width: '900px', minWidth: '200px'}" [minY]="500"
          [maximizable]="true" [draggable]="true" [baseZIndex]="10000">
  <div style="width: 100%;height: 500px;" *ngIf="inventorReturnModel.inventarReturnGenerator">
    <app-generator [transferToSection]="inventorReturnModel" [name]="dialogName" ></app-generator>
  </div>
  <div style="width: 100%;height: 500px;" *ngIf="!inventorReturnModel.inventarReturnGenerator">
    <div class="ui-g ui-fluid">
      <div class="ui-g-12 ui-md-8">
        <div class="ui-g-12 ui-md-6">
          <p>თარიღი</p>
          <p-calendar [minDate]="minDate" dateFormat="dd-mm-yy" [(ngModel)]="inventorReturnModel.date" [showIcon]="true" [ngClass]="{ 'red':if_error(formErrors,'date')?'1px solid red': '' }"></p-calendar>
        </div>
        <div class="ui-g-12 ui-md-6">
          <p>სექცია</p>
          <p-dropdown [ngClass]="{ 'red':if_error(formErrors,'selectedSection')?'1px solid red': '' }" [options]="stockList" optionLabel="name" placeholder="აირჩიეთ სექცია" [(ngModel)]="inventorReturnModel.selectedSection"  (ngModelChange)="getTransferProperty()"  ></p-dropdown>
        </div>
        <div class="ui-g-12 ui-md-6">
          <p>ფროფერთი</p>
          <p-dropdown   [ngClass]="{ 'red':if_error(formErrors,'selectedProperty')?'1px solid red': '' }" [options]="propertyData" optionLabel="fullname" placeholder="ფროფერთი" [(ngModel)]="inventorReturnModel.selectedProperty" ></p-dropdown>
        </div>
        <div class="ui-g-12 ui-md-6">
          <p>ტრანსპორტ. პასხ. პირი:</p>
          <p-autoComplete [ngClass]="{ 'red':if_error(formErrors,'selectedCarrier')?'1px solid red': '' }"  [suggestions]="staffList" (completeMethod)="filterStaff($event)" [size]="30" [(ngModel)]="inventorReturnModel.selectedCarrier"
                          [minLength]="1" placeholder=""  field="fname" [dropdown]="true">
            <ng-template let-brand pTemplate="item">
              <div class="ui-helper-clearfix" style="border-bottom:1px solid #D5D5D5">
                <div style="font-size:14px;font-weight: bold">{{brand['fname']}}</div>
                <div style="font-size:12px;">{{brand['position']}}</div>
              </div>
            </ng-template>
          </p-autoComplete>
        </div>
      </div>

      <div class="ui-g-12 ui-md-4">
        <p>კომენტარი</p>
        <textarea pInputTextarea placeholder="შენიშვნა" [(ngModel)]="inventorReturnModel.note" rows="5"></textarea>
      </div>
      <app-cart [data]="cartItemsData" (checker)="checker($event)"></app-cart>
    </div>
  </div>
  <p-footer>
    <app-cart-button (removeCartItem)="removeCartItem()"></app-cart-button>
    <button style="position: absolute; left: 230px" pButton type="button" icon="pi pi-file" label="ფაილები ({{ uploadFiles.length}})" (click)="filesDialog=true"> </button>
    <span style="width: 20px; margin-right: 20px" *ngIf="inventorReturnModel.inventarReturnGenerator">
      ბოლო კოდი - {{lastCode}}
    </span>
    <button type="button" pButton icon="pi pi-check"  *ngIf="!inventorReturnModel.inventarReturnGenerator"(click)="generateInventarReturn()" label="ზედდებულის გენერაცია"></button>
    <button type="button" pButton icon="pi pi-check"  *ngIf="inventorReturnModel.inventarReturnGenerator" (click)="activateInventarReturn()" label="ზედდებულის გააქტიურება"></button>
    <button type="button" pButton icon="pi pi-close" (click)="display=false" label="დახურვა" class="ui-button-secondary"></button>
  </p-footer>
</p-dialog>
<p-dialog header=" "
         *ngIf="cartDialogShow" [(visible)]="cartDialogShow" [modal]="true" [responsive]="true" [style]="{width: '700px', minWidth: '200px'}" [minY]="500" [maximizable]="true" [draggable]="true" [baseZIndex]="10000">
  <div style="width: 100%;height: 500px;">
    <app-cart-button (removeCartItem)="removeCartItem()"></app-cart-button>
    <app-cart style="position: relative; top:30px;"  [data]="cartItemsData" (removeCartItem)="removeCartItem()" ></app-cart>
  </div>
</p-dialog>
<p-dialog header="ინვენტარის მოძრაობა შენობებს შორის" *ngIf="inventoryToBuildingDialogShow" [(visible)]="inventoryToBuildingDialogShow" [modal]="true" [responsive]="true" [style]="{width: '900px', minWidth: '200px'}" [minY]="500"
          [maximizable]="true" [draggable]="true" [baseZIndex]="10000">
  <div style="width: 100%;height: 500px;" *ngIf="inventorTransfer.generator">
    <app-generator [transferToSection]="inventorTransfer" [name]="dialogName" ></app-generator>
  </div>
  <div style="width: 100%;height: 500px;" *ngIf="!inventorTransfer.generator">
    <p-tabView (onChange)="onTabChange($event)" >
      <p-tabPanel header="შენობა" [selected]="true" >
        <div class="ui-g ui-fluid" >
          <div class="ui-g-12 ui-md-8">
            <div class="ui-g-12 ui-md-6">
              <p>თარიღი</p>
              <p-calendar [minDate]="minDate"  dateFormat="dd-mm-yy" [(ngModel)]="inventorTransfer.date" [showIcon]="true" [ngClass]="{ 'red':if_error(formErrors,'date')?'1px solid red': '' }"></p-calendar>
            </div>

            <div class="ui-g-12 ui-md-6">
              <p>ფროფერთი</p>
              <p-autoComplete [suggestions]="staffList" (completeMethod)="filterStaff($event)" [size]="30" [(ngModel)]="inventorTransfer.selectedProperty"
                              [minLength]="1" placeholder=""  field="fname" [dropdown]="true" [ngClass]="{ 'red':if_error(formErrors,'selectedProperty')?'1px solid red': '' }">
                <ng-template let-brand pTemplate="item">
                  <div class="ui-helper-clearfix" style="border-bottom:1px solid #D5D5D5">
                    <div style="font-size:14px;font-weight: bold">{{brand['fname']}}</div>
                    <div style="font-size:12px;">{{brand['position']}}</div>
                  </div>
                </ng-template>
              </p-autoComplete>
            </div>

            <div class="ui-g-12 ui-md-6">
              <p>მომთხოვნი პიროვნება</p>
              <p-autoComplete [suggestions]="staffList" (completeMethod)="filterStaff($event)" [size]="30" [(ngModel)]="inventorTransfer.selectedRequestPerson"
                              [minLength]="1" placeholder=""  field="fname" [dropdown]="true"  [ngClass]="{ 'red':if_error(formErrors,'selectedRequestPerson')?'1px solid red': '' }">
                <ng-template let-brand pTemplate="item">
                  <div class="ui-helper-clearfix" style="border-bottom:1px solid #D5D5D5">
                    <div style="font-size:14px;font-weight: bold">{{brand['fname']}}</div>
                    <div style="font-size:12px;">{{brand['position']}}</div>
                  </div>
                </ng-template>
              </p-autoComplete>
            </div>

            <div class="ui-g-12 ui-md-6">
              <p>ტრანსპორტ. პასხ. პირი:</p>
              <p-autoComplete [suggestions]="staffList" (completeMethod)="filterStaff($event)" [size]="30" [(ngModel)]="inventorTransfer.selectedCarrier"
                              [minLength]="1" placeholder=""  field="fname" [dropdown]="true" [ngClass]="{ 'red':if_error(formErrors,'selectedCarrier')?'1px solid red': '' }" >
                <ng-template let-brand pTemplate="item">
                  <div class="ui-helper-clearfix" style="border-bottom:1px solid #D5D5D5">
                    <div style="font-size:14px;font-weight: bold">{{brand['fname']}}</div>
                    <div style="font-size:12px;">{{brand['position']}}</div>
                  </div>
                </ng-template>
              </p-autoComplete>
            </div>
          </div>
          <div class="ui-g-12 ui-md-4">
            <p>კომენტარი</p>
            <textarea pInputTextarea placeholder="შენიშვნა" rows="5" [(ngModel)]="inventorTransfer.note" [ngClass]="{ 'red':if_error(formErrors,'note')?'1px solid red': '' }"></textarea>
          </div>
        </div>
      </p-tabPanel>
      <p-tabPanel header="პიროვნება" >
        <div class="ui-g ui-fluid" >
          <div class="ui-g-12 ui-md-8">
            <div class="ui-g-12 ui-md-6">
              <p>თარიღი</p>
              <p-calendar [minDate]="minDate" dateFormat="dd-mm-yy" [(ngModel)]="inventorTransfer.date" [showIcon]="true" [ngClass]="{ 'red':if_error(formErrors,'date')?'1px solid red': '' }"></p-calendar>
            </div>
            <div class="ui-g-12 ui-md-6">
              <p>ფროფერთი</p>
              <p-autoComplete [suggestions]="staffList" (completeMethod)="filterStaff($event)" [size]="30" [(ngModel)]="inventorTransfer.selectedProperty"
                              [minLength]="1" placeholder=""  field="fname" [dropdown]="true" [ngClass]="{ 'red':if_error(formErrors,'selectedProperty')?'1px solid red': '' }">
                <ng-template let-brand pTemplate="item">
                  <div class="ui-helper-clearfix" style="border-bottom:1px solid #D5D5D5">
                    <div style="font-size:14px;font-weight: bold">{{brand['fname']}}</div>
                    <div style="font-size:12px;">{{brand['position']}}</div>
                  </div>
                </ng-template>
              </p-autoComplete>
            </div>
            <div class="ui-g-12 ui-md-6">
              <p>პიროვნება</p>
              <p-autoComplete [suggestions]="staffList" (completeMethod)="filterStaff($event)" [size]="30" [(ngModel)]="inventorTransfer.selectedPerson"
                              (onSelect)="selectPerson($event)" [minLength]="1" placeholder=""  field="fname" [dropdown]="true" [ngClass]="{ 'red':if_error(formErrors,'selectedPerson')?'1px solid red': '' }">
                <ng-template let-brand pTemplate="item">
                  <div class="ui-helper-clearfix" style="border-bottom:1px solid #D5D5D5">
                    <div style="font-size:14px;font-weight: bold">{{brand['fname']}}</div>
                    <div style="font-size:12px;">{{brand['position']}}</div>
                  </div>
                </ng-template>
              </p-autoComplete>
            </div>

            <div class="ui-g-12 ui-md-6">
              <p>ტრანსპორტ. პასხ. პირი:</p>
              <p-autoComplete [suggestions]="staffList" (completeMethod)="filterStaff($event)" [size]="30" [(ngModel)]="inventorTransfer.selectedCarrier"
                              [minLength]="1" placeholder=""  field="fname" [dropdown]="true" [ngClass]="{ 'red':if_error(formErrors,'selectedCarrier')?'1px solid red': '' }">
                <ng-template let-brand pTemplate="item">
                  <div class="ui-helper-clearfix" style="border-bottom:1px solid #D5D5D5">
                    <div style="font-size:14px;font-weight: bold">{{brand['fname']}}</div>
                    <div style="font-size:12px;">{{brand['position']}}</div>
                  </div>
                </ng-template>
              </p-autoComplete>
            </div>
            <div class="ui-g-12 ui-md-4">
              <p>კომენტარი</p>
              <textarea pInputTextarea placeholder="შენიშვნა" rows="1" [(ngModel)]="inventorTransfer.note"></textarea>
            </div>
          </div>
          <div class="ui-g-12 ui-md-4">
            <div class="ui-g-12 ui-md-12">
              <p>მომთხოვნი პიროვნება</p>
              <p-autoComplete [suggestions]="staffList" (completeMethod)="filterStaff($event)" [size]="30" [(ngModel)]="inventorTransfer.selectedRequestPerson"
                              [minLength]="1" placeholder=""   field="fname" [dropdown]="true" [ngClass]="{ 'red':if_error(formErrors,'selectedRequestPerson')?'1px solid red': '' }">
                <ng-template let-brand pTemplate="item">
                  <div class="ui-helper-clearfix" style="border-bottom:1px solid #D5D5D5">
                    <div style="font-size:14px;font-weight: bold">{{brand['fname']}}</div>
                    <div style="font-size:12px;">{{brand['position']}}</div>
                  </div>
                </ng-template>
              </p-autoComplete>
            </div>
            <div class="ui-g-12 ui-md-12">
              <p>სექცია</p>
              <p-dropdown [disabled]="!inventorTransfer.selectedProperty" [options]="stockList" optionLabel="name" placeholder="აირჩიეთ სექცია" [(ngModel)]="inventorTransfer.selectedSection" [ngClass]="{ 'red':if_error(formErrors,'selectedSection')?'1px solid red': '' }" ></p-dropdown>
            </div>

          </div>
        </div>
      </p-tabPanel>
    </p-tabView>
    <app-cart [data]="cartItemsData" (checker)="checker($event)"></app-cart>

  </div>
  <p-footer>
    <app-cart-button (removeCartItem)="removeCartItem()"></app-cart-button>
    <button style="position: absolute; left: 230px" pButton type="button" icon="pi pi-file" label="ფაილები ({{ uploadFiles.length}})" (click)="filesDialog=true"> </button>
    <span style="width: 20px; margin-right: 20px" *ngIf="inventorTransfer.generator">
      ბოლო კოდი - {{lastCode}}
    </span>
    <button type="button" pButton icon="pi pi-check"  *ngIf="!inventorTransfer.generator" (click)="generaTeInventorTransfer()" label="ზედდებულის გენერაცია"></button>
    <button type="button" pButton icon="pi pi-check"  *ngIf="inventorTransfer.generator"  (click)="activeInventorTransfer()" label="ზედდებულის გააქტიურება"></button>
    <button type="button" pButton icon="pi pi-close" (click)="inventoryToBuildingDialogShow=false" label="დახურვა" class="ui-button-secondary"></button>
  </p-footer>
</p-dialog>
<p-dialog header="განპიროვნება" *ngIf="personDialogShow" [(visible)]="personDialogShow" [modal]="true" [responsive]="true" [style]="{width: '900px', minWidth: '200px'}" [minY]="500"
          [maximizable]="true" [draggable]="true" [baseZIndex]="10000">
  <div style="width: 100%;height: 500px;" *ngIf="forPerson.generator">
    <app-generator [transferToSection]="forPerson"  [name]="dialogName"></app-generator>
  </div>
  <div style="width: 100%;height: 500px;" *ngIf="!forPerson.generator">

        <div class="ui-g ui-fluid" >
          <div class="ui-g-12 ui-md-8">
            <div class="ui-g-12 ui-md-6">
              <p>თარიღი</p>
              <p-calendar [minDate]="minDate" dateFormat="dd-mm-yy" [(ngModel)]="forPerson.date" [showIcon]="true" [ngClass]="{ 'red':if_error(formErrors,'date')?'1px solid red': '' }"></p-calendar>
            </div>
            <div class="ui-g-12 ui-md-6">
              <p>პიროვნება</p>
              <p-autoComplete [suggestions]="staffList" (completeMethod)="filterStaff($event)" [size]="30" [(ngModel)]="forPerson.selectedPerson"
                              (onSelect)="selectPerson($event)" [minLength]="1" placeholder=""  field="fname" [dropdown]="true" [ngClass]="{ 'red':if_error(formErrors,'selectedPerson')?'1px solid red': '' }">
                <ng-template let-brand pTemplate="item">
                  <div class="ui-helper-clearfix" style="border-bottom:1px solid #D5D5D5">
                    <div style="font-size:14px;font-weight: bold">{{brand['fname']}}</div>
                    <div style="font-size:12px;">{{brand['position']}}</div>
                  </div>
                </ng-template>
              </p-autoComplete>
            </div>
            <div class="ui-g-12 ui-md-12">
              <p>აირჩიეთ ოთახი</p>
              <p-dropdown [disabled]="!forPerson.selectedPerson" [options]="roomsList" optionLabel="name" placeholder="აირჩიეთ ოთახი" [(ngModel)]="forPerson.selectedRoom" [ngClass]="{ 'red':if_error(formErrors,'selectedRoom')?'1px solid red': '' }" ></p-dropdown>
            </div>
          </div>

          <div class="ui-g-12 ui-md-4">
            <p>კომენტარი</p>
            <textarea pInputTextarea placeholder="შენიშვნა" rows="5" [(ngModel)]="forPerson.note"></textarea>
          </div>
          <app-cart [data]="cartItemsData" (checker)="checker($event)" ></app-cart>
        </div>
  </div>
  <p-footer>
    <app-cart-button (removeCartItem)="removeCartItem()"></app-cart-button>
    <button style="position: absolute; left: 230px" pButton type="button" icon="pi pi-file" label="ფაილები ({{ uploadFiles.length}})" (click)="filesDialog=true"> </button>
    <span style="width: 20px; margin-right: 20px" *ngIf="forPerson.generator">
      ბოლო კოდი - {{lastCode}}
    </span>
    <button type="button" pButton icon="pi pi-check"  *ngIf="!forPerson.generator" (click)="generateForPersonInvoice()" label="ზედდებულის გენერაცია"></button>
    <button type="button" pButton icon="pi pi-check"  *ngIf="forPerson.generator"  (click)="activeForPersonTransferInvoice()" label="ზედდებულის გააქტიურება"></button>
    <button type="button" pButton icon="pi pi-close" (click)="personDialogShow=false" label="დახურვა" class="ui-button-secondary"></button>
  </p-footer>
</p-dialog>

<p-dialog header="ფაილების მიმაგრება" *ngIf="filesDialog" [(visible)]="filesDialog" [modal]="true" [responsive]="true" [style]="{width: '700px', minWidth: '200px'}" [minY]="500" [maximizable]="true" [draggable]="true" [baseZIndex]="10000">
  <div style="width: 100%;min-height: 250px;">
    <app-file-uploader (onFiles)="uploadedFiles($event)" [files]="uploadFiles"></app-file-uploader>
  </div>
</p-dialog>
